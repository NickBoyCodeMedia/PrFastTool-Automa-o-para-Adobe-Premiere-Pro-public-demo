<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pr-FastTool</title>
    <style>
        body {
            margin: 0;
            padding: 15px;
            background: #2b2b2b;
            color: #d1d1d1;
            font-family: 'Montserrat', 'Segoe UI', 'Arial Black', 'Segoe UI', Arial, sans-serif;
            font-size: 13px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #555;
        }

        .header h1 {
            margin: 0;
            color: #007acc;
            font-size: 18px;
            font-weight: bold;
        }

        .header .subtitle {
            color: #999;
            font-size: 11px;
            margin-top: 5px;
        }

        .tool-section {
            background: #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #555;
        }

        .section-title {
            color: #007acc;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 14px;
            border-bottom: 1px solid #555;
            padding-bottom: 5px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .checkbox-option:hover {
            background: rgba(0, 122, 204, 0.1);
        }

        .checkbox-option input {
            margin-right: 8px;
            accent-color: #007acc;
        }

        .checkbox-option label {
            cursor: pointer;
            font-size: 12px;
        }

        .slider-container {
            margin-bottom: 15px;
            padding: 10px;
            background: #3a3a3a;
            border-radius: 6px;
            border: 1px solid #555;
        }

        .slider-label {
            display: block;
            margin-bottom: 8px;
            color: #d1d1d1;
            font-size: 12px;
            font-weight: 500;
        }

        .blur-value {
            color: #007acc;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: #555;
            outline: none;
            border-radius: 4px;
            appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #007acc;
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #007acc;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .primary-btn {
            background: linear-gradient(135deg, #007acc, #005a99);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .primary-btn:hover {
            background: linear-gradient(135deg, #005a99, #004080);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .primary-btn:active {
            transform: translateY(0);
        }

        #log-container {
            flex: 1;
            background: #1a1a1a;
            border-radius: 6px;
            border: 1px solid #555;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .log-header {
            background: #333;
            padding: 8px 12px;
            border-bottom: 1px solid #555;
            color: #999;
            font-size: 11px;
            font-weight: bold;
        }

        #log {
            flex: 1;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.4;
            overflow-y: auto;
            white-space: pre-wrap;
            color: #d1d1d1;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: #4caf50;
        }

        .status-error {
            background: #f44336;
        }

        .status-info {
            background: #2196f3;
        }

        /* Scrollbar customization */
        #log::-webkit-scrollbar {
            width: 8px;
        }

        #log::-webkit-scrollbar-track {
            background: #2a2a2a;
        }

        #log::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        #log::-webkit-scrollbar-thumb:hover {
            background: #666;
        }

        /* Estilos revisados para o sistema de abas */
        .tabs-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .tab-navigation {
            display: flex;
            margin-bottom: 0;
            position: relative;
            z-index: 2;
        }

        .tab-button {
            background: #2a2a2a;
            color: #999;
            border: 1px solid #555;
            border-bottom: none;
            padding: 8px 15px;
            cursor: pointer;
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            margin-right: 4px;
            font-size: 12px;
            transition: all 0.2s;
            position: relative;
            top: 1px;
        }

        .tab-button.active {
            background: #333;
            color: #007acc;
            font-weight: bold;
            border-bottom: 1px solid #333;
        }

        .tab-button:hover:not(.active) {
            background: #303030;
            color: #d1d1d1;
        }

        .tab-contents {
            border: 1px solid #555;
            border-radius: 0 6px 6px 6px;
            background: #333;
            padding: 0;
            overflow: hidden;
        }

        .tab-content {
            display: none;
            padding: 15px;
        }

        .tab-content.active {
            display: block;
        }

        .tool-section {
            background: transparent;
            border-radius: 0;
            padding: 0;
            margin-bottom: 0;
            border: none;
        }

        /* Estilos para elementos desabilitados */
        .checkbox-option.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            position: relative;
        }

        .checkbox-option.disabled::after {
            content: "Em breve";
            position: absolute;
            right: 5px;
            font-size: 9px;
            background-color: #555;
            color: #ccc;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .checkbox-option.disabled input,
        .checkbox-option.disabled label {
            cursor: not-allowed;
        }

        .number-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #444;
        }

        /* Estilos revisados para tooltips */
        [data-tooltip] {
            position: static;
            cursor: pointer;
        }
        [data-tooltip]::after {
            display: none !important;
        }

        .info-icon {
            display: inline-block;
            width: 14px;
            height: 14px;
            background-color: #555;
            border-radius: 50%;
            color: #fff;
            text-align: center;
            font-size: 10px;
            line-height: 14px;
            margin-left: 5px;
            cursor: help;
        }

        /* Estilos para social icons */
        .tab-social {
            display: flex;
            align-items: center;
            margin-left: auto;
            gap: 10px;
        }

        .icon-link {
            display: flex;
            align-items: center;
            color: #999;
            text-decoration: none;
            font-size: 11px;
            transition: color 0.2s;
            padding: 3px 6px;
            border-radius: 4px;
            background: transparent;
            border: none;
            cursor: pointer;
        }

        .icon-link:hover {
            color: #d1d1d1;
            background: rgba(255, 255, 255, 0.05);
        }

        .icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 5px;
            filter: brightness(0.7);
            transition: filter 0.2s;
        }

        .icon-link:hover .icon {
            filter: brightness(1);
        }

        /* Estilos para modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
        }

        .modal-content {
            background-color: #333;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #555;
            border-radius: 6px;
            width: 80%;
            max-width: 500px;
            color: #d1d1d1;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
        }

        .close {
            color: #999;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #d1d1d1;
        }

        .modal-content h2 {
            color: #007acc;
            margin-top: 0;
        }

        .modal-content h3 {
            color: #ccc;
            margin-top: 15px;
            margin-bottom: 5px;
        }

        .modal-content ul {
            padding-left: 20px;
            margin: 5px 0;
        }

        .modal-content li {
            margin-bottom: 5px;
        }

        /* Novo estilo para bot√£o com input integrado */
        .integrated-input-btn {
            padding: 0 !important;
            overflow: hidden;
            position: relative;
            height: auto !important;
        }
        
        .integrated-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 8px;
        }
        
        .integrated-input-btn .btn-label {
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 6px;
            width: 100%;
        }
        
        .integrated-input-btn .input-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0;
            background: rgba(0, 0, 0, 0.15);
            padding: 4px 8px;
            border-radius: 4px;
            width: 90%;
        }
        
        .integrated-input-btn input {
            width: 40px;
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #fff;
            font-size: 13px;
            padding: 3px 5px;
            text-align: center;
            height: 22px;
        }
        
        .integrated-input-btn input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0);
        }
        
        .integrated-input-btn .unit-label {
            color: rgba(255, 255, 255, 0.8);
            margin-left: 4px;
            font-size: 12px;
            user-select: none;
        }

        /* Problemas com o estilo do bot√£o Set In/Out:
         * 1. A altura m√≠nima (min-height:45px) pode n√£o ser suficiente para todos os layouts
         * 2. O background do input-row (rgba(0, 0, 0, 0.15)) n√£o tem contraste suficiente
         * 3. A largura do input (40px) pode ser muito estreita para valores mais longos
         * 4. O tamanho do bot√£o n√£o √© exatamente igual aos outros bot√µes
         * 5. O campo num√©rico pode ser dif√≠cil de clicar por ser pequeno
         */
        .integrated-input-btn {
            padding: 0 !important;
            overflow: hidden;
            position: relative;
            height: auto !important;
        }
        
        .integrated-input-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 8px;
        }
        
        .integrated-input-btn .btn-label {
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 6px;
            width: 100%;
        }
        
        .integrated-input-btn .input-row {
            display: flex; /* Organiza os elementos em linha */
            align-items: center; /* Centraliza verticalmente os itens */
            justify-content: center; /* Centraliza horizontalmente os itens */
            margin-top: 0; /* Remove margem superior */
            background: rgba(0, 0, 0, 0); /* Contraste baixo */
            padding: 4px 8px; /* Espa√ßamento interno */
            border-radius: 4px; /* Bordas arredondadas */
            width: 10%; /* Largura relativa ao bot√£o */
        }
        
        .integrated-input-btn input {
            width: 80px; /* Muito estreito para valores maiores */
            background: rgba(255, 255, 255, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #fff;
            font-size: 13px;
            padding: 3px 5px;
            text-align: center;
            height: 22px;
        }
        
        .integrated-input-btn input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0);
        }
        
        .integrated-input-btn .unit-label {
            color: rgba(255, 255, 255, 0.8);
            margin-left: 4px;
            font-size: 12px;
            user-select: none;
        }


        /* Estilos para o alerta padronizado */
        .custom-alert {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(3px);
        }
        
        .alert-content {
            width: 380px;
            background: linear-gradient(to bottom, #333, #2a2a2a);
            border: 1px solid #555;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            padding: 0;
            overflow: hidden;
            animation: alertFadeIn 0.3s ease-out;
        }
        
        @keyframes alertFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-header {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #444;
        }
        
        .alert-header.success {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
        }
        
        .alert-header.error {
            background: linear-gradient(135deg, #f44336, #c62828);
        }
        
        .alert-header.warning {
            background: linear-gradient(135deg, #ff9800, #e65100);
        }
        
        .alert-header.info {
            background: linear-gradient(135deg, #007acc, #005a99);
        }
        
        .alert-tool-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }
        
        .alert-header h3 {
            margin: 0;
            flex-grow: 1;
            font-size: 16px;
            color: white;
            font-weight: bold;
        }
        
        .alert-body {
            padding: 18px;
            color: #e0e0e0;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .alert-body p {
            margin: 0;
        }
        
        .alert-footer {
            padding: 12px 15px;
            text-align: right;
            background: rgba(0, 0, 0, 0.15);
            border-top: 1px solid #444;
        }
        
        .alert-footer .primary-btn {
            width: auto;
            min-width: 80px;
            padding: 8px 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span style="color:#fff; letter-spacing:2px; font-size:22px; font-weight:900; text-shadow:0 2px 8px #007acc99, 0 1px 0 #000;">
            <span style="color:#007acc;">Pr</span>-Fast<span style="color:#007acc;">Tool</span>
            </span>
        </h1>
        <div class="subtitle">Professional Tools for Premiere Pro &mdash; by Nickboy3d ¬∑ Code &amp; Media</div>
    </div>

    <div class="tabs-container">
        <div class="tab-navigation">
            <div class="tab-button active" data-tab="backfill">Back Fill</div>
            <div class="tab-button" data-tab="verticalstack">Vertical Stack</div>
            <div class="tab-button" data-tab="smarttools">Smart Tools</div>
            
            <!-- Social links - modificados para usar JavaScript ao inv√©s de links diretos -->
            <div class="tab-social">
                <button class="icon-link" id="instagramBtn">
                    <img src="../assets/insta-icon.png" alt="Instagram" class="icon">
                    <span>Instagram</span>
                </button>
                <button class="icon-link" id="youtubeBtn">
                    <img src="../assets/youtube-icon.png" alt="YouTube" class="icon">
                    <span>YouTube</span>
                </button>
                <button id="aboutBtn" class="icon-link">
                    <span class="icon">‚ùó</span>
                    <span>Sobre</span>
                </button>
            </div>
        </div>
        
        <div class="tab-contents">
            <div class="tab-content active" id="backfill-tab">
                <div class="tool-section">
                    <div class="section-title">Back Fill Options <span class="info-icon" data-tooltip="Duplica clips para a trilha inferior e aplica efeitos">?</span></div>
                    
                    <div class="options-grid">
                        <div class="checkbox-option">
                            <input type="checkbox" id="addBlur" checked>
                            <label for="addBlur" data-tooltip="Adiciona efeito de desfoque ao clip duplicado">üåÄ Blur Effect</label>
                        </div>
                        <div class="checkbox-option disabled">
                            <input type="checkbox" id="addAnimation" disabled>
                            <label for="addAnimation" data-tooltip="Adiciona anima√ß√£o sutil ao clip duplicado">üé¨ Subtle Animation</label>
                        </div>
                        <div class="checkbox-option disabled">
                            <input type="checkbox" id="addNest" disabled>
                            <label for="addNest" data-tooltip="Cria um nest com o clip original e o duplicado">üì¶ Auto Nest</label>
                        </div>
                        <div class="checkbox-option disabled">
                            <input type="checkbox" id="addAdjustment" disabled>
                            <label for="addAdjustment" data-tooltip="Adiciona uma camada de ajuste acima">üé® Adjustment Layer</label>
                        </div>
                    </div>

                    <div class="slider-container">
                        <label for="blurIntensity" class="slider-label" data-tooltip="Controla a intensidade do efeito de desfoque">
                            Blur Intensity: <span class="blur-value" id="blurValue">50</span>%
                        </label>
                        <input type="range" id="blurIntensity" min="0" max="100" value="50" 
                               oninput="document.getElementById('blurValue').textContent = this.value">
                    </div>

                    <button id="backFillBtn" class="primary-btn" data-tooltip="Processa os clips selecionados na timeline">
                        ‚ñ∂ Execute Back Fill
                    </button>
                </div>
            </div>

            <div class="tab-content" id="verticalstack-tab">
                <div class="tool-section">
                    <div class="section-title">Vertical Stack Clips <span class="info-icon" data-tooltip="Empilha verticalmente 3 clips selecionados no painel Project">?</span></div>
                    
                    <div class="slider-container">
                        <label for="vsScaleSlider" class="slider-label" data-tooltip="Define a escala dos clips empilhados">
                            Scale: <span class="blur-value" id="vsScaleValue">56</span>%
                        </label>
                        <input type="range" id="vsScaleSlider" min="1" max="100" value="56" 
                               oninput="document.getElementById('vsScaleValue').textContent = this.value">
                    </div>
                    
                    <div class="number-input-container">
                        <div class="number-label" data-tooltip="Define o espa√ßamento entre os clips">Gap Between Clips (pixels):</div>
                        <div class="number-controls">
                            <button class="number-button disabled" id="decreaseGap" disabled>-</button>
                            <input type="text" class="number-value" id="gapValue" value="0" readonly>
                            <button class="number-button" id="increaseGap">+</button>
                        </div>
                    </div>

                    <div class="checkbox-option">
                        <input type="checkbox" id="maintainAspectRatio" checked>
                        <label for="maintainAspectRatio" data-tooltip="Mant√©m as propor√ß√µes originais dos clips">üîí Maintain Aspect Ratio</label>
                    </div>

                    <button id="verticalStackBtn" class="primary-btn" data-tooltip="Selecione exatamente 3 clips no painel Project antes de executar">
                        ‚ñ∂ Stack Clips Vertically
                    </button>
                </div>
            </div>

            <!-- RENOMEADA ABA: Smart Tools -->
            <div class="tab-content" id="smarttools-tab">
                <div class="tool-section">
                    <div class="section-title" style="display: flex; align-items: center;">
                        Smart Tools
                        <span class="info-icon" id="smartToolsInfoBtn" style="margin-left:8px; cursor:pointer;">?</span>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px;">
                        <button class="primary-btn" id="pulseMarkBtn" style="flex:1;">ü•Å PulseMark</button>
                        <button class="primary-btn" id="voidTrimBtn" style="flex:1;">‚úÇÔ∏è VoidTrim</button>
                        <button class="primary-btn" id="randomizeClipsBtn" style="flex:1;">üîÄ Randomize Clips</button>
                        
                        <!-- Bot√£o Set In/Out redesenhado com campo de dura√ß√£o integrado -->
                        <div style="flex:1;">  <!-- Container com flex:1 para garantir largura igual aos outros bot√µes -->
                            <div style="display:flex; flex-direction:column; height:100%;">
                                <div class="input-row" style="margin-bottom:5px; background:#3a3a3a; border-radius:4px; padding:5px; display:flex; justify-content:center;">
                                    <input type="number" id="inOutDuration" value="2.0" min="0.1" max="300" step="0.1" style="width:60px; background:#444; border:1px solid #555; color:#fff; border-radius:3px; padding:3px 5px; text-align:center;">
                                    <span style="margin-left:4px; line-height:22px; color:#ccc;">segundos</span>
                                </div>
                                <button class="primary-btn" id="setInOutBtn" style="flex-grow:1;">
                                    <img src="../assets/icon-setInOut.svg" alt="Set In/Out Icon" style="width:16px; height:16px; margin-right:6px; vertical-align:middle;"> Set In/Out
                                </button>
                            </div>
                        </div>
                        
                        <button class="primary-btn" id="deleteAudioMarkersBtn" style="flex:1;">üßπ Delete Markers</button>
                        <button class="primary-btn" id="clearInOutBtn" style="flex:1;">üßΩ Clear In/Out</button>
                    </div>
                    <div id="smartToolsInfoBox" style="display:none; background:#23273a; color:#e0e6f8; border:1px solid #3a4a6a; border-radius:8px; padding:14px 18px; font-size:12px; margin-bottom:10px; margin-top:2px; box-shadow:0 4px 16px rgba(0,0,0,0.18);">
                        Ferramentas r√°pidas para manipula√ß√£o de clips no painel Project e na timeline.<br>
                        <b>PuleMark</b>: Marca batidas automaticamente em arquivos de √°udio.<br>
                        <b>VoidTrim</b>: Remove sil√™ncios detectados em arquivos de √°udio.<br>
                        <b>Randomize Clips</b>: Embaralha os clips selecionados e coloca em nova sequ√™ncia.<br>
                        <b>Set In/Out</b>: Define pontos In & Out dos clips selecionados.<br>
                        <b>Delete Markers</b>: Remove todos os markers dos clips de √°udio selecionados.<br>
                        <b>Clear In/Out</b>: Limpa pontos In & Out dos clips selecionados.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="log-container">
        <div class="log-header">
            <span class="status-indicator status-info"></span>
            Execution Log
        </div>
        <div id="log">Pr-FastTool initialized successfully ‚úì
Ready to process your clips...</div>
    </div>

    <!-- Modal About -->
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">&times;</span>
            <h2>Pr-FastTool v1.8.1 beta</h2>
            <p>Ferramenta profissional para agilizar o fluxo de trabalho no Adobe Premiere Pro.</p>
            <h3>Recursos</h3>
            <ul>
                <li>Back Fill - Duplica√ß√£o de clips com efeitos</li>
                <li>Vertical Stack - Empilhamento vertical de 3 clips</li>
                <li>Interface otimizada com sistema de abas</li>
                <li>Log de execu√ß√£o detalhado</li>
            </ul>
            <h3>Desenvolvedor</h3>
            <p>NickBoy3d Code & Media</p>
            <h3>Contato</h3>
            <a href="https://nickboy3d.artstation.com/" target="_blank" class="icon-link">https://nickboy3d.artstation.com/</a>
        </div>
    </div>

<!-- Alerta personalizado padronizado -->
<div id="prFastToolAlert" class="modal custom-alert">
    <div class="modal-content alert-content">
        <div class="alert-header">
            <img id="alertIcon" src="../assets/icon-success.png" class="alert-tool-icon">
            <h3 id="alertTitle">PrFastTool</h3>
            <span id="closeAlert" class="close">&times;</span>
        </div>
        <div class="alert-body">
            <p id="alertMessage"></p>
        </div>
        <div class="alert-footer">
            <button id="alertOkBtn" class="primary-btn">OK</button>
        </div>
    </div>
</div>

    <script src="../libs/CSInterface.js"></script>
    <!-- Adicionar o utilit√°rio CEP-fix para resolver problemas de retorno undefined -->
    <script src="../js/cep-fix.js"></script>
    <script>
        const csInterface = new CSInterface();
        const path = require('path'); // ADICIONE ESTA LINHA
        // SUBSTITUA o bloco de require por este com caminho absoluto:
        let pulsemark = null;
        let voidtrim = null;

        try {
            const extensionPath = csInterface.getSystemPath('extension');
            log('üìÅ Extension path: ' + extensionPath);
            
            const pulsePath = extensionPath + '/node/pulsemark.js';
            log('üîç Tentando carregar pulsemark de: ' + pulsePath);
            pulsemark = require(pulsePath);
            log('‚úÖ pulsemark carregado: ' + typeof pulsemark);
            log('‚úÖ pulsemark.analyzeAudioAndAddMarkers: ' + typeof pulsemark.analyzeAudioAndAddMarkers);
        } catch (pulseErr) {
            log('‚ùå Erro ao carregar pulsemark: ' + pulseErr.message, true);
        }

        try {
            const extensionPath = csInterface.getSystemPath('extension');
            const voidPath = extensionPath + '/node/voidtrim.js';
            log('üîç Tentando carregar voidtrim de: ' + voidPath);
            voidtrim = require(voidPath);
            log('‚úÖ voidtrim carregado: ' + typeof voidtrim);
            log('‚úÖ voidtrim.removeSilence: ' + typeof voidtrim.removeSilence);
        } catch (voidErr) {
            log('‚ùå Erro ao carregar voidtrim: ' + voidErr.message, true);
        }

        try {
            log('üîç Testando require do node-wav...');
            const wavTest = require('node-wav');
            log('‚úÖ node-wav dispon√≠vel: ' + typeof wavTest);
        } catch (wavErr) {
            log('‚ùå Erro com node-wav: ' + wavErr.message, true);
        }

        log('üìä Status final:');
        log('  pulsemark: ' + (pulsemark ? 'CARREGADO' : 'FALHOU'));
        log('  voidtrim: ' + (voidtrim ? 'CARREGADO' : 'FALHOU'));

        function log(message, isError = false) {
            const logDiv = document.getElementById('log');
            if (logDiv) {
                if (logDiv.innerHTML.includes("Pr-FastTool initialized")) {
                    logDiv.innerHTML = "";
                }

                const time = new Date().toLocaleTimeString();
                const icon = isError ? '‚ùå' : '‚úÖ';
                const entry = document.createElement('div');
                entry.innerHTML = `<span style="color: #666">[${time}]</span> ${icon} ${message}`;
                entry.style.color = isError ? '#ff6b6b' : '#d1d1d1';
                entry.style.marginBottom = '2px';
                
                if (logDiv.firstChild) {
                    logDiv.insertBefore(entry, logDiv.firstChild);
                } else {
                    logDiv.appendChild(entry);
                }

                // Auto scroll to top
                logDiv.scrollTop = 0;
            }
        }

        function logWarning(message) {
            const logDiv = document.getElementById('log');
            if (logDiv) {
                const time = new Date().toLocaleTimeString();
                const entry = document.createElement('div');
                entry.innerHTML = `<span style="color: #666">[${time}]</span> ‚ö†Ô∏è ${message}`;
                entry.style.color = '#ffa726';
                entry.style.marginBottom = '2px';
                
                if (logDiv.firstChild) {
                    logDiv.insertBefore(entry, logDiv.firstChild);
                } else {
                    logDiv.appendChild(entry);
                }
                logDiv.scrollTop = 0;
            }
        }

        function executeBackFill() {
            log('üöÄ Starting Back Fill process...');
            
            const options = {
                addBlur: document.getElementById('addBlur').checked,
                blurIntensity: document.getElementById('blurIntensity').value,
                // Estas op√ß√µes est√£o desabilitadas na interface, ent√£o vamos definir como false
                addAnimation: false, // document.getElementById('addAnimation').checked,
                addNest: false, // document.getElementById('addNest').checked,
                addAdjustment: false // document.getElementById('addAdjustment').checked
            };
            
            // Show options in a nice format
            const optionsStr = [
                options.addBlur ? `Blur: ${options.blurIntensity}%` : null
                // Removendo op√ß√µes desabilitadas do log
                // options.addAnimation ? 'Animation' : null,
                // options.addNest ? 'Nest' : null,
                // options.addAdjustment ? 'Adjustment' : null
            ].filter(Boolean).join(', ');
            
            log(`‚öôÔ∏è Options: ${optionsStr || 'Default processing'}`);
            
            const script = 'executeBackFill(' + JSON.stringify(options) + ');';
            
            csInterface.evalScript(script, function(result) {
                if (result && result !== "EvalScript error.") {
                    try {
                        const resultObj = JSON.parse(result);
                        
                        // Log da mensagem principal
                        if (resultObj.success) {
                            log(`üéâ ${resultObj.message}`);
                        } else {
                            log(`${resultObj.message}`, true);
                        }
                        
                        // Log dos erros detalhados
                        if (resultObj.errors && resultObj.errors.length > 0) {
                            resultObj.errors.forEach(error => {
                                if (resultObj.success) {
                                    logWarning(error);
                                } else {
                                    log(`üí° ${error}`, true);
                                }
                            });
                        }
                        
                        // Log de estat√≠sticas se houver processamento
                        if (resultObj.processedClips > 0) {
                            let statsMsg = `üìä Stats: ${resultObj.processedClips} processed, ${resultObj.successCount} successful, ${resultObj.failCount} failed`;
                            if (resultObj.nestedCount > 0) {
                                statsMsg += `, ${resultObj.nestedCount} nested`;
                            }
                            log(statsMsg);
                        }
                        
                    } catch (e) {
                        log(`‚ú® ${result}`);
                    }
                } else {
                    log('üí• Script execution failed - Verifique se o Premiere Pro est√° aberto e com um projeto ativo', true);
                    log('üí° Dica: Abra um projeto e uma sequ√™ncia antes de usar o Back Fill', true);
                }
            });
        }

        // Sistema de abas
        function setupTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remover classe ativa de todos os bot√µes
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Adicionar classe ativa ao bot√£o clicado
                    button.classList.add('active');
                    
                    // Mostrar o conte√∫do da aba correspondente
                    const tabName = button.getAttribute('data-tab');
                    
                    // Esconder todos os conte√∫dos
                    document.querySelectorAll('.tab-content').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // Mostrar conte√∫do da aba selecionada
                    document.getElementById(tabName + '-tab').classList.add('active');
                });
            });
        }

        // Controle do gap entre clips - modificando para desabilitar o bot√£o de diminuir
        function setupGapControls() {
            const decreaseBtn = document.getElementById('decreaseGap');
            const increaseBtn = document.getElementById('increaseGap');
            const gapValue = document.getElementById('gapValue');
            
            // Fun√ß√£o para decrease desabilitada
            // decreaseBtn.addEventListener('click', () => {
            //     let value = parseInt(gapValue.value);
            //     if (value > 0) {
            //         gapValue.value = value - 1;
            //     }
            // });
            
            increaseBtn.addEventListener('click', () => {
                let value = parseInt(gapValue.value);
                gapValue.value = value + 1;
            });
        }
        
        // Fun√ß√£o para executar o Vertical Stack
        function executeVerticalStack() {
            log('üöÄ Starting Vertical Stack process...');
            
            const options = {
                scale: parseInt(document.getElementById('vsScaleSlider').value),
                gap: parseInt(document.getElementById('gapValue').value),
                maintainAspectRatio: document.getElementById('maintainAspectRatio').checked
            };
            
            log(`‚öôÔ∏è Options: Scale ${options.scale}%, Gap ${options.gap}px, Maintain Aspect Ratio: ${options.maintainAspectRatio}`);
            
            // Chamar a fun√ß√£o no ExtendScript
            const script = 'executeVerticalStackClips(' + JSON.stringify(options) + ');';
            
            csInterface.evalScript(script, function(result) {
                if (result && result !== "EvalScript error.") {
                    try {
                        const resultObj = JSON.parse(result);
                        
                        // Log da mensagem principal
                        if (resultObj.success) {
                            log(`üéâ ${resultObj.message}`);
                        } else {
                            log(`${resultObj.message}`, true);
                        }
                        
                        // Log dos erros detalhados
                        if (resultObj.errors && resultObj.errors.length > 0) {
                            resultObj.errors.forEach(error => {
                                log(`üí° ${error}`, true);
                            });
                        }
                        
                        // Mostrar estat√≠sticas
                        if (resultObj.processedClips > 0) {
                            log(`üìä Stats: ${resultObj.processedClips} processed, ${resultObj.failedClips || 0} failed`);
                        }
                    } catch (e) {
                        log(`‚ú® ${result}`);
                    }
                } else {
                    log('üí• Script execution failed - Verifique se o Premiere Pro est√° aberto', true);
                    log('üí° Dica: Selecione no m√°ximo 3 clips no painel Project', true);
                }
            });
        }

        // Modal About
        function setupAboutModal() {
            const aboutBtn = document.getElementById('aboutBtn');
            const aboutModal = document.getElementById('aboutModal');
            const closeModalBtn = document.getElementById('closeModal');
            
            // Abrir modal
            aboutBtn.addEventListener('click', function() {
                aboutModal.style.display = 'block';
            });
            
            // Fechar modal
            closeModalBtn.addEventListener('click', function() {
                aboutModal.style.display = 'none';
            });
            
            // Fechar quando clicar fora do modal
            window.addEventListener('click', function(event) {
                if (event.target == aboutModal) {
                    aboutModal.style.display = 'none';
                }
            });
        }

        // Fun√ß√£o para abrir URLs externos usando a API do CEP
        function openExternalURL(url) {
            if (csInterface && typeof csInterface.openURLInDefaultBrowser === 'function') {
                csInterface.openURLInDefaultBrowser(url);
            } else {
                console.error('N√£o foi poss√≠vel abrir a URL: Interface CEP n√£o dispon√≠vel');
                // Fallback para navegadores ou testes
                window.open(url, '_blank');
            }
        }
        
        // Configurar links sociais
        function setupSocialLinks() {
            // Instagram
            document.getElementById('instagramBtn').addEventListener('click', function() {
                openExternalURL('https://www.instagram.com/nickboy3d/');
            });
            
            // YouTube
            document.getElementById('youtubeBtn').addEventListener('click', function() {
                openExternalURL('https://www.youtube.com/@NickBoy3d');
            });
        }

        window.addEventListener('DOMContentLoaded', function() {
            log('üîß DOM loaded successfully');

            // Add event listener to button
            document.getElementById('backFillBtn').addEventListener('click', executeBackFill);

            // Load hostscript
            const extensionPath = csInterface.getSystemPath('extension');
            const jsxPath = extensionPath + '/jsx/hostscript.jsx';
            
            log('üîç Tentando carregar hostscript de: ' + jsxPath);
            
            // Primeiro verificar se o arquivo existe
            const fs = require('fs');
            if (fs.existsSync(jsxPath)) {
                log('‚úÖ Arquivo hostscript.jsx encontrado');
                
                csInterface.evalScript(`$.evalFile("${jsxPath.replace(/\\/g, '\\\\')}")`, function(result) {
                    log('üì• Resposta do carregamento do hostscript:');
                    log('  - Tipo: ' + typeof result);
                    log('  - Conte√∫do: ' + result);
                    
                    if (result && result !== "EvalScript error.") {
                        log('‚úÖ ExtendScript engine ready');
                        
                        // Testar se a fun√ß√£o existe
                        csInterface.evalScript('typeof getSelectedAudioFilePath', function(testResult) {
                            log('üîç Testando fun√ß√£o getSelectedAudioFilePath: ' + testResult);
                            if (testResult === 'function') {
                                log('‚úÖ Fun√ß√£o getSelectedAudioFilePath dispon√≠vel');
                            } else {
                                log('‚ùå Fun√ß√£o getSelectedAudioFilePath n√£o encontrada', true);
                            }
                        });
                    } else {
                        log('‚ùå Erro ao carregar hostscript: ' + result, true);
                        
                        // Tentar carregar diretamente o conte√∫do
                        try {
                            const jsxContent = fs.readFileSync(jsxPath, 'utf8');
                            log('üîç Tentando carregar conte√∫do direto do JSX...');
                            
                            csInterface.evalScript(jsxContent, function(directResult) {
                                log('üì• Resultado do carregamento direto: ' + directResult);
                                if (directResult && directResult !== "EvalScript error.") {
                                    log('‚úÖ Hostscript carregado via conte√∫do direto');
                                } else {
                                    log('‚ùå Falha tamb√©m no carregamento direto', true);
                                }
                            });
                        } catch (readErr) {
                            log('‚ùå Erro ao ler arquivo JSX: ' + readErr.message, true);
                        }
                    }
                });
            } else {
                log('‚ùå Arquivo hostscript.jsx n√£o encontrado em: ' + jsxPath, true);
            }

            log('üéØ Ready for Back Fill operations');

            // Inicializar sistema de abas
            setupTabs();
            
            // Inicializar controles de gap
            setupGapControls();
            
            // Event listener para bot√£o Vertical Stack
            document.getElementById('verticalStackBtn').addEventListener('click', executeVerticalStack);

            // Inicializar modal about
            setupAboutModal();

            // Inicializar links sociais
            setupSocialLinks();
            
            // Tornar a fun√ß√£o openSmartToolsTab acess√≠vel globalmente
            window.openSmartToolsTab = openSmartToolsTab;
            
            // Event listeners para os bot√µes da aba Smart Tools
            document.getElementById('pulseMarkBtn').addEventListener('click', function() {
                log('ü•Å [ETAPA 1] PulseMark button clicado');
                
                // ETAPA 2: Testar se as depend√™ncias est√£o carregadas
                log('üîç [ETAPA 2] Verificando depend√™ncias...');
                log('  - pulsemark module: ' + (pulsemark ? 'DISPON√çVEL' : 'INDISPON√çVEL'));
                log('  - csInterface: ' + (csInterface ? 'DISPON√çVEL' : 'INDISPON√çVEL'));
                log('  - extensionPath: ' + extensionPath);
                
                if (!pulsemark) {
                    log('‚ùå [ERRO ETAPA 2] M√≥dulo pulsemark n√£o carregado', true);
                    return;
                }
                
                // ETAPA 3: Executar o script JSX para obter caminho do √°udio
                log('üîç [ETAPA 3] Chamando getSelectedAudioFilePath() no ExtendScript...');
                const script = `getSelectedAudioFilePath();`;
                
                csInterface.evalScript(script, function(audioResult) {
                    log('üì• [ETAPA 4] Resposta do ExtendScript recebida');
                    log('  - Tipo da resposta: ' + typeof audioResult);
                    log('  - Conte√∫do: ' + audioResult);
                    
                    if (!audioResult || audioResult === "EvalScript error.") {
                        log('‚ùå [ERRO ETAPA 4] Script ExtendScript falhou', true);
                        log('üí° Poss√≠veis causas: Premiere n√£o aberto, nenhuma sequ√™ncia ativa, nenhum clip selecionado', true);
                        return;
                    }
                    
                    // ETAPA 5: Parse da resposta JSON
                    log('üîç [ETAPA 5] Fazendo parse da resposta JSON...');
                    try {
                        const audioInfo = JSON.parse(audioResult);
                        log('‚úÖ [ETAPA 5] JSON parseado com sucesso');
                        log('  - success: ' + audioInfo.success);
                        log('  - message: ' + audioInfo.message);
                        
                        if (audioInfo.success) {
                            // ETAPA 6: Arquivo encontrado
                            const filePath = audioInfo.filePath;
                            const fileName = audioInfo.fileName;
                            
                            log(`‚úÖ [ETAPA 6] Arquivo v√°lido encontrado`);
                            log(`  - Nome: ${fileName}`);
                            log(`  - Caminho: ${filePath}`);
                            
                            // ETAPA 7: Chamar an√°lise de √°udio
                            log('üîç [ETAPA 7] Iniciando an√°lise de √°udio...');
                            const bpm = 120; // BPM padr√£o
                            
                            pulsemark.analyzeAudioAndAddMarkers(filePath, bpm, function(result) {
                                if (result.success) {
                                    // Atualizar o valor para o BPM detectado
                                    if (result.detectedBpm) {
                                        log(`üéµ BPM detectado: ${result.detectedBpm}`);
                                    }
                                    
                                    // Adicionar marcadores √† timeline
                                    csInterface.evalScript(`addBeatsToTimeline(${JSON.stringify(result.beatTimes)})`, function(res) {
                                        log('üì• [ETAPA 10] Resposta do addBeatsToTimeline recebida');
                                        log('  - Tipo: ' + typeof res);
                                        log('  - Conte√∫do: ' + res);
                                        
                                        if (res && res !== "EvalScript error.") {
                                            try {
                                                const markerResult = JSON.parse(res);
                                                if (markerResult.success) {
                                                    log(`‚úÖ [ETAPA 10] Marcadores adicionados: ${markerResult.markersAdded} marcadores`);
                                                    
                                                    // Mostrar alerta de sucesso com detalhes da opera√ß√£o
                                                    const bpmMessage = result.detectedBpm ? `\nBPM detectado: ${result.detectedBpm}` : '';
                                                    showSuccessAlert(
                                                        "PulseMark", 
                                                        `<span style="font-size:15px">‚úÖ <b>PulseMark conclu√≠do!</b></span><br><br>
                                                         <b>${markerResult.markersAdded}</b> marcadores adicionados com sucesso.<br>
                                                         ${result.detectedBpm ? '<b>BPM detectado:</b> ' + result.detectedBpm : ''}`,
                                                         "../assets/icon-pulsemark.png"
                                                    );
                                                } else {
                                                    log(`‚ö†Ô∏è [ETAPA 10] Falha ao adicionar marcadores: ${markerResult.message}`, true);
                                                    
                                                    // Alerta de erro
                                                    alert(`‚ö†Ô∏è Falha ao adicionar marcadores: ${markerResult.message}`);
                                                }
                                            } catch (e) {
                                                log(`‚ö†Ô∏è [ETAPA 10] Resposta n√£o √© JSON v√°lido: ${e.message}`, true);
                                                log(`  - Resposta original: ${res}`);
                                                
                                                // Alerta de erro no parsing
                                                alert(`‚ö†Ô∏è Erro ao processar resposta: ${e.message}`);
                                            }
                                        } else {
                                            log('‚ùå [ERRO ETAPA 10] ExtendScript falhou ao adicionar marcadores', true);
                                            
                                            // Alerta de erro no ExtendScript
                                            alert('‚ùå Falha ao adicionar marcadores √† timeline.');
                                        }
                                    });
                                } else {
                                    log(`‚ùå [ERRO ETAPA 8] Falha na an√°lise: ${result.message}`, true);
                                }
                            });
                        } else {
                            log(`‚ùå [ERRO ETAPA 6] ${audioInfo.message}`, true);
                            log('üí° Dicas: Selecione um clip de √°udio na timeline, certifique-se que h√° uma sequ√™ncia ativa', true);
                        }
                    } catch (e) {
                        log('‚ùå [ERRO ETAPA 5] Erro ao fazer parse do JSON: ' + e.message, true);
                        log('  - Resposta original: ' + audioResult, true);
                    }
                });
            });
            
            document.getElementById('voidTrimBtn').addEventListener('click', function() {
                log('‚úÇÔ∏è Iniciando VoidTrim...');
                const script = `getSelectedAudioFilePath();`;
                
                csInterface.evalScript(script, function(audioPath) {
                    if (audioPath && audioPath !== "EvalScript error." && audioPath !== '""') {
                        try {
                            const audioInfo = JSON.parse(audioPath);
                            
                            if (audioInfo.success) {
                                const filePath = audioInfo.filePath;
                                const fileName = audioInfo.fileName;
                                
                                log(`üéµ Arquivo selecionado: ${fileName}`);
                                log(`üìÅ Caminho: ${filePath}`);
                                
                                if (voidtrim) {
                                    const threshold = -30; // dB
                                    const minSilenceDur = 0.5; // segundos
                                    
                                    log(`üîá Analisando sil√™ncio com threshold=${threshold}dB e dura√ß√£o m√≠nima=${minSilenceDur}s`);
                                    
                                    voidtrim.removeSilence(filePath, threshold, minSilenceDur, function(result) {
                                        if (result.success) {
                                            log(`‚úÖ ${result.message}`);
                                            
                                            if (result.silenceSegments.length > 0) {
                                                result.silenceSegments.forEach((segment, index) => {
                                                    log(`üîá Sil√™ncio ${index + 1}: ${segment.start.toFixed(2)}s - ${segment.end.toFixed(2)}s (${segment.duration.toFixed(2)}s)`);
                                                });
                                                
                                                // Enviar os segmentos para o JSX
                                                const jsxScript = `removeSilenceSegments(${JSON.stringify(result.silenceSegments)});`;
                                                csInterface.evalScript(jsxScript, function(jsxResult) {
                                                    if (jsxResult && jsxResult !== "EvalScript error.") {
                                                        log(`‚úÇÔ∏è ${jsxResult}`);
                                                    } else {
                                                        log('üí• Erro ao processar sil√™ncio no JSX', true);
                                                    }
                                                });
                                            } else {
                                                log('üéµ Nenhum segmento de sil√™ncio encontrado com os par√¢metros atuais');
                                            }
                                        } else {
                                            log(`‚ùå ${result.message}`, true);
                                        }
                                    });
                                } else {
                                    log('‚ùå M√≥dulo VoidTrim n√£o dispon√≠vel', true);
                                }
                            } else {
                                log(`‚ùå ${audioInfo.message}`, true);
                                log('üí° Selecione um clip de √°udio na timeline', true);
                            }
                        } catch (e) {
                            log('‚ùå Erro ao processar informa√ß√µes do √°udio: ' + e.message, true);
                        }
                    } else {
                        log('üí• Nenhum arquivo de √°udio selecionado ou arquivo n√£o acess√≠vel', true);
                        log('üí° Selecione um clip de √°udio na timeline antes de usar o VoidTrim', true);
                    }
                });
            });
            
            // Implementa√ß√£o do bot√£o Randomize Clips
            document.getElementById('randomizeClipsBtn').addEventListener('click', function() {
                log('üîÄ Iniciando Randomize Clips...');
                
                const randomizeJsxPath = extensionPath + '/jsx/randomizeClips.jsx';
                
                try {
                    const fs = require('fs');
                    if (fs.existsSync(randomizeJsxPath)) {
                        log('‚úÖ Script randomizeClips.jsx encontrado, executando...');
                        
                        // Carregar e executar o script JSX
                        csInterface.evalScript(`$.evalFile("${randomizeJsxPath.replace(/\\/g, '\\\\')}")`, function(result) {
                            if (result && result !== "EvalScript error.") {
                                log('‚úÖ Randomize Clips executado com sucesso!');
                                
                                // Extrair informa√ß√µes relevantes do resultado
                                let clipCount = "v√°rios";
                                let newSeqName = "";
                                
                                // Tentar extrair o nome da sequ√™ncia e contagem de clipes do resultado
                                const seqNameMatch = result.match(/Nova sequ√™ncia: ([^\.]+)/);
                                if (seqNameMatch && seqNameMatch[1]) {
                                    newSeqName = seqNameMatch[1];
                                }
                                
                                const clipCountMatch = result.match(/Total de clipes coletados para randomiza√ß√£o: (\d+)/);
                                if (clipCountMatch && clipCountMatch[1]) {
                                    clipCount = clipCountMatch[1];
                                }
                                
                                log(result);
                                
                                // Mostrar alerta personalizado de sucesso
                                showSuccessAlert(
                                    "Randomize Clips", 
                                    `<span style="font-size:15px">‚úÖ <b>Randomiza√ß√£o conclu√≠da!</b></span><br><br>
                                    <b>${clipCount}</b> clipes foram reorganizados aleatoriamente.<br>
                                    Nova sequ√™ncia: <b>${newSeqName}</b><br><br>
                                    <span style="color:#ccc; font-size:12px;">Recomendado: revise manualmente a timeline.</span>`,
                                    "../assets/icon-randomize.png"
                                );
                                
                            } else {
                                log('‚ùå Erro ao executar Randomize Clips', true);
                                log('üí° Verifique se h√° clipes selecionados na sequ√™ncia ativa', true);
                                
                                // Alerta personalizado de erro
                                showErrorAlert(
                                    "Randomize Clips",
                                    `<span style="font-size:15px">‚ùå <b>Falha na opera√ß√£o</b></span><br><br>
                                    N√£o foi poss√≠vel randomizar os clipes.<br><br>
                                    <span style="color:#ffcc99; font-size:13px;">üí° Verifique se h√° clipes selecionados na sequ√™ncia ativa.</span>`,
                                    "../assets/icon-randomize.png"
                                );
                            }
                        });
                    } else {
                        log('‚ùå Script randomizeClips.jsx n√£o encontrado em: ' + randomizeJsxPath, true);
                        
                        // Alerta personalizado para script n√£o encontrado
                        showErrorAlert(
                            "Erro no Sistema",
                            `<span style="font-size:15px">‚ùå <b>Arquivo n√£o encontrado</b></span><br><br>
                            O arquivo de script n√£o foi encontrado:<br>
                            <code>${randomizeJsxPath}</code><br><br>
                            Verifique a instala√ß√£o da extens√£o.`,
                            "../assets/icon-error.png"
                        );
                    }
                } catch (e) {
                    log('‚ùå Erro ao verificar script: ' + e.message, true);
                    
                    // Alerta personalizado para erro gen√©rico
                    showErrorAlert(
                        "Erro no Sistema",
                        `<span style="font-size:15px">‚ùå <b>Erro interno</b></span><br><br>
                        A fun√ß√£o "Randomize Clips" encontrou um erro:<br>
                        <code>${e.message}</code>`,
                        "../assets/icon-error.png"
                    );
                }
            });
            
            // Implementa√ß√£o do bot√£o Set In/Out - VERS√ÉO SIMPLIFICADA E DIRETA
            document.getElementById('setInOutBtn').addEventListener('click', function() {
                log('‚è© Iniciando Set In/Out...');
                
                const extensionPath = csInterface.getSystemPath('extension');
                const setInOutJsxPath = extensionPath + '/jsx/setInOut.jsx';
                
                try {
                    const fs = require('fs');
                    if (fs.existsSync(setInOutJsxPath)) {
                        log('‚úÖ Script setInOut.jsx encontrado, executando...');
                        
                        // Obter dura√ß√£o do input separado
                        const duration = parseFloat(document.getElementById('inOutDuration').value) || 2.0;
                        log(`‚è±Ô∏è Dura√ß√£o definida: ${duration}s`);
                        
                        // Chamar a fun√ß√£o apenas no clique do bot√£o
                        const jsxCode = `
                            $.evalFile("${setInOutJsxPath.replace(/\\/g, '\\\\')}");
                            
                            // Verificar se h√° itens selecionados primeiro
                            var selection = app.getCurrentProjectViewSelection();
                            if (!selection || selection.length === 0) {
                                '{"status":"erro", "mensagem":"Nenhum clip selecionado no painel Project."}';
                            } else {
                                // Executar a fun√ß√£o com a dura√ß√£o especificada
                                try {
                                    // Agora sabemos que o nome da fun√ß√£o √© executarSetInOut
                                    var result = executarSetInOut(${duration});
                                    
                                    if (typeof result === "object") {
                                        JSON.stringify(result);
                                    } else if (result === true) {
                                        '{"status":"sucesso", "mensagem":"Pontos In/Out aplicados com sucesso."}';
                                    } else {
                                        '{"status":"erro", "mensagem":"Falha ao aplicar pontos In/Out."}';
                                    }
                                } catch(e) {
                                    '{"status":"erro", "mensagem":"Erro ao executar: ' + e.message + '"}';
                                }
                            }
                        `;
                        
                        csInterface.evalScript(jsxCode, function(resultStr) {
                            // Verificar se temos uma resposta v√°lida
                            if (!resultStr || resultStr === "undefined" || resultStr === "EvalScript error.") {
                                log('‚ùå Erro ao executar Set In/Out', true);
                                log('üí° Verifique se h√° clipes selecionados no painel Project', true);
                                
                                // Alerta de erro
                                showErrorAlert(
                                    "Set In/Out",
                                    `<span style="font-size:15px">‚ùå <b>Falha na opera√ß√£o</b></span><br><br>
                                    N√£o foi poss√≠vel executar o script.<br><br>
                                    <span style="color:#ffcc99; font-size:13px;">üí° Verifique se h√° clips selecionados no painel Project.</span>`,
                                    "../assets/icon-set-inout.png"
                                );
                                return;
                            }
                            
                            try {
                                // Tentar parsear o resultado (agora como string JSON)
                                const result = JSON.parse(resultStr);
                                
                                // L√≥gica simplificada: Se tiver status=sucesso, √© sucesso
                                if (result.status === "sucesso") {
                                    log('‚úÖ Set In/Out executado com sucesso!');
                                    if (result.mensagem) {
                                        log(`‚úÖ ${result.mensagem}`);
                                    }
                                    
                                    // Alerta de sucesso
                                    showSuccessAlert(
                                        "Set In/Out", 
                                        `<span style="font-size:15px">‚úÖ <b>Opera√ß√£o conclu√≠da!</b></span><br><br>
                                        ${result.mensagem}<br>
                                        <span style="color:#8ff;">Dura√ß√£o definida: ${duration} segundos</span>`,
                                        "../assets/icon-set-inout.png"
                                    );
                                } else {
                                    // Qualquer outro status √© erro
                                    log('‚ùå Erro ao executar Set In/Out', true);
                                    if (result.mensagem) {
                                        log(`üí° ${result.mensagem}`, true);
                                    } else {
                                        log('üí° Verifique se h√° clipes selecionados no painel Project', true);
                                    }
                                    
                                    // Alerta de erro
                                    showErrorAlert(
                                        "Set In/Out",
                                        `<span style="font-size:15px">‚ùå <b>Falha na opera√ß√£o</b></span><br><br>
                                        ${result.mensagem || 'Erro ao definir pontos In/Out'}<br><br>
                                        <span style="color:#ffcc99; font-size:13px;">üí° Verifique se h√° clips selecionados no painel Project.</span>`,
                                        "../assets/icon-set-inout.png"
                                    );
                                }
                            } catch (e) {
                                // Se n√£o puder parsear, exibir o resultado como est√°
                                log('‚úÖ Set In/Out executado!');
                                log(`Resultado: ${resultStr}`);
                                
                                // Alerta com informa√ß√£o b√°sica
                                showInfoAlert(
                                    "Set In/Out",
                                    `<span style="font-size:15px">‚ÑπÔ∏è <b>Opera√ß√£o conclu√≠da</b></span><br><br>
                                    A opera√ß√£o foi conclu√≠da, mas n√£o foi poss√≠vel interpretar o resultado.<br>
                                    <span style="color:#8ff;">Dura√ß√£o definida: ${duration} segundos</span>`,
                                    "../assets/icon-set-inout.png"
                                );
                            }
                        });
                    } else {
                        log('‚ùå Script setInOut.jsx n√£o encontrado em: ' + setInOutJsxPath, true);
                        
                        // Alerta de arquivo n√£o encontrado
                        showErrorAlert(
                            "Erro no Sistema",
                            `<span style="font-size:15px">‚ùå <b>Arquivo n√£o encontrado</b></span><br><br>
                            O arquivo de script n√£o foi encontrado:<br>
                            <code>${setInOutJsxPath}</code><br><br>
                            Verifique a instala√ß√£o da extens√£o.`,
                            "../assets/icon-error.png"
                        );
                    }
                } catch (e) {
                    log('‚ùå Erro ao verificar script: ' + e.message, true);
                    
                    // Alerta de erro de sistema
                    showErrorAlert(
                        "Erro no Sistema",
                        `<span style="font-size:15px">‚ùå <b>Erro interno</b></span><br><br>
                        A fun√ß√£o "Set In/Out" encontrou um erro:<br>
                        <code>${e.message}</code>`,
                        "../assets/icon-error.png"
                    );
                }
            });
            
            // Implementa√ß√£o do bot√£o Delete Markers
            document.getElementById('deleteAudioMarkersBtn').addEventListener('click', function() {
                log('üßπ Iniciando Delete Markers...');
                
                const deleteMarkJsxPath = extensionPath + '/jsx/deleteMark.jsx';
                
                try {
                    const fs = require('fs');
                    if (fs.existsSync(deleteMarkJsxPath)) {
                        log('‚úÖ Script deleteMark.jsx encontrado, executando...');
                        
                        // Carregar e executar o script JSX
                        csInterface.evalScript(`$.evalFile("${deleteMarkJsxPath.replace(/\\/g, '\\\\')}")`, function(result) {
                            if (result && result !== "EvalScript error.") {
                                try {
                                    // Tentar parsear o resultado como JSON
                                    const deleteResult = JSON.parse(result);
                                    log('‚úÖ Delete Markers executado com sucesso!');
                                    log(deleteResult.message);
                                    
                                    if (deleteResult.success) {
                                        // Exibir alerta personalizado de sucesso
                                        showSuccessAlert(
                                            "Delete Markers", 
                                            `<span style="font-size:15px">‚úÖ <b>Opera√ß√£o conclu√≠da!</b></span><br><br>
                                            ${deleteResult.message}`,
                                            "../assets/icon-delete-markers.png"
                                        );
                                    } else {
                                        // Exibir alerta personalizado de aviso
                                        showWarningAlert(
                                            "Delete Markers",
                                            `<span style="font-size:15px">‚ö†Ô∏è <b>Aten√ß√£o</b></span><br><br>
                                            ${deleteResult.message}`,
                                            "../assets/icon-delete-markers.png"
                                        );
                                    }
                                } catch (e) {
                                    log('‚ùå Erro ao processar resultado: ' + e.message, true);
                                    log('Resultado original: ' + result);
                                    
                                    // Caso n√£o consiga processar JSON, mostrar resultado como est√°
                                    showInfoAlert(
                                        "Delete Markers",
                                        `<span style="font-size:15px">‚ÑπÔ∏è <b>Resultado</b></span><br><br>
                                        ${result}`,
                                        "../assets/icon-delete-markers.png"
                                    );
                                }
                            } else {
                                log('‚ùå Erro ao executar Delete Markers', true);
                                log('üí° Verifique se h√° clipes de √°udio selecionados na timeline', true);

                                // Exibir alerta personalizado de erro
                                showErrorAlert(
                                    "Delete Markers",
                                    `<span style="font-size:15px">‚ùå <b>Falha na opera√ß√£o</b></span><br><br>
                                    Verifique se h√° clipes de √°udio selecionados na timeline.`,
                                    "../assets/icon-delete-markers.png"
                                );                                
                            }
                        });
                    } else {
                        log('‚ùå Script deleteMark.jsx n√£o encontrado em: ' + deleteMarkJsxPath, true);
                        showErrorAlert(
                            "Erro no Sistema",
                            `<span style="font-size:15px">‚ùå <b>Arquivo n√£o encontrado</b></span><br><br>
                            O arquivo de script n√£o foi encontrado:<br>
                            <code>${deleteMarkJsxPath}</code><br><br>
                            Verifique a instala√ß√£o da extens√£o.`,
                            "../assets/icon-error.png"
                        );
                    }
                } catch (e) {
                    log('‚ùå Erro ao verificar script: ' + e.message, true);
                    showErrorAlert(
                        "Erro no Sistema",
                        `<span style="font-size:15px">‚ùå <b>Erro interno</b></span><br><br>
                        A fun√ß√£o "Delete Markers" encontrou um erro:<br>
                        <code>${e.message}</code>`,
                        "../assets/icon-error.png"
                    );
                }
            });
            
            // Bot√£o Clear In/Out - atualizar implementa√ß√£o
            document.getElementById('clearInOutBtn').addEventListener('click', function() {
                log('üßΩ Iniciando Clear In/Out...');
                
                const clearInOutJsxPath = extensionPath + '/jsx/clearInOutB.jsx';
                
                try {
                    const fs = require('fs');
                    if (fs.existsSync(clearInOutJsxPath)) {
                        log('‚úÖ Script clearInOutB.jsx encontrado, executando...');
                        
                        // Carregar e executar o script JSX
                        csInterface.evalScript(`$.evalFile("${clearInOutJsxPath.replace(/\\/g, '\\\\')}")`, function(result) {
                            if (result && result !== "EvalScript error.") {
                                try {
                                    // Tentar parsear o resultado como JSON
                                    const resultObj = JSON.parse(result);
                                    
                                    if (resultObj.status === "sucesso") {
                                        log(`‚úÖ Clear In/Out executado com sucesso!`);
                                        log(`üìä ${resultObj.mensagem}`);
                                        
                                        // Adicionar alerta de sucesso
                                        showSuccessAlert(
                                            "Clear In/Out", 
                                            `<span style="font-size:15px">‚úÖ <b>Opera√ß√£o conclu√≠da!</b></span><br><br>
                                            ${resultObj.mensagem}<br>
                                            ${resultObj.sucessos > 0 ? `<span style="color:#8ff;">Clips processados: ${resultObj.sucessos}</span>` : ''}`,
                                            "../assets/icon-clear-inout.png"
                                        );
                                    } else {
                                        log(`‚ùå ${resultObj.mensagem}`, true);
                                        
                                        // Adicionar alerta de erro
                                        showErrorAlert(
                                            "Clear In/Out",
                                            `<span style="font-size:15px">‚ùå <b>Falha na opera√ß√£o</b></span><br><br>
                                            ${resultObj.mensagem}<br><br>
                                            <span style="color:#ffcc99; font-size:13px;">üí° Verifique se h√° clips selecionados no painel Project.</span>`,
                                            "../assets/icon-clear-inout.png"
                                        );
                                    }
                                } catch (e) {
                                    // Se n√£o for JSON, exibir como texto
                                    log(`‚úÖ Clear In/Out executado: ${result}`);
                                    
                                    // Alerta com resultado bruto
                                    showInfoAlert(
                                        "Clear In/Out",
                                        `<span style="font-size:15px">‚ÑπÔ∏è <b>Opera√ß√£o conclu√≠da</b></span><br><br>
                                        Resultado: ${result}`,
                                        "../assets/icon-clear-inout.png"
                                    );
                                }
                            } else {
                                log('‚ùå Erro ao executar Clear In/Out', true);
                                log('üí° Verifique se h√° clipes selecionados no painel Project', true);
                                
                                // Alerta de erro
                                showErrorAlert(
                                    "Clear In/Out",
                                    `<span style="font-size:15px">‚ùå <b>Falha na opera√ß√£o</b></span><br><br>
                                    Erro ao executar o script.<br><br>
                                    <span style="color:#ffcc99; font-size:13px;">üí° Verifique se h√° clipes selecionados no painel Project.</span>`,
                                    "../assets/icon-clear-inout.png"
                                );
                            }
                        });
                    } else {
                        log('‚ùå Script clearInOutB.jsx n√£o encontrado em: ' + clearInOutJsxPath, true);
                        
                        // Alerta de arquivo n√£o encontrado
                        showErrorAlert(
                            "Erro no Sistema",
                            `<span style="font-size:15px">‚ùå <b>Arquivo n√£o encontrado</b></span><br><br>
                            O arquivo de script n√£o foi encontrado:<br>
                            <code>${clearInOutJsxPath}</code><br><br>
                            Verifique a instala√ß√£o da extens√£o.`,
                            "../assets/icon-error.png"
                        );
                    }
                } catch (e) {
                    log('‚ùå Erro ao verificar script: ' + e.message, true);
                    
                    // Alerta de erro de sistema
                    showErrorAlert(
                        "Erro no Sistema",
                        `<span style="font-size:15px">‚ùå <b>Erro interno</b></span><br><br>
                        A fun√ß√£o "Clear In/Out" encontrou um erro:<br>
                        <code>${e.message}</code>`,
                        "../assets/icon-error.png"
                    );
                }
            });
        });

        
        // Fun√ß√£o para executar VoidTrim - VERS√ÉO SIMPLIFICADA  
        function executeVoidTrim() {
            log('‚úÇÔ∏è Starting VoidTrim process...');
            
            if (!voidtrim) {
                log('‚ùå VoidTrim module not available', true);
                return;
            }
            
            const script = `getSelectedAudioFilePath();`;
            
            csInterface.evalScript(script, function(audioPath) {
                if (audioPath && audioPath !== "EvalScript error." && audioPath !== '""') {
                    const filePath = audioPath.replace(/"/g, '');
                    const threshold = -30; // dB
                    const minSilenceDur = 0.5; // segundos
                    
                    log('üîá Analyzing real silence in: ' + path.basename(filePath));
                    
                    // Use Node.js para an√°lise REAL de sil√™ncio
                    voidtrim.removeSilence(filePath, threshold, minSilenceDur, function(result) {
                        if (result.success) {
                            log(`üéâ ${result.message}`);
                            
                            if (result.silenceSegments.length > 0) {
                                result.silenceSegments.forEach((segment, index) => {
                                    log(`üîá Sil√™ncio ${index + 1}: ${segment.start.toFixed(2)}s - ${segment.end.toFixed(2)}s (${segment.duration.toFixed(2)}s)`);
                                });
                                
                                // Envie os segmentos reais para o JSX
                                const jsxScript = `removeSilenceSegments(${JSON.stringify(result.silenceSegments)});`;
                                csInterface.evalScript(jsxScript, function(jsxResult) {
                                    if (jsxResult && jsxResult !== "EvalScript error.") {
                                        log(`‚úÇÔ∏è Segmentos de sil√™ncio reais processados no JSX`);
                                } else {
                                    log('üí• Erro ao processar sil√™ncio no JSX', true);
                                }
                            });
                        } else {
                            log('üéµ Nenhum segmento de sil√™ncio encontrado com os par√¢metros atuais');
                        }
                        } else {
                            log(`‚ùå ${result.message}`, true);
                        }
                    });
                } else {
                    log('üí• Nenhum arquivo de √°udio selecionado ou arquivo n√£o acess√≠vel', true);
                    log('üí° Selecione um clip de √°udio WAV na timeline', true);
                }
            });
        }
    </script>
    <script>
        // Mostrar/ocultar info da Smart Tools
        document.addEventListener('DOMContentLoaded', function() {
            var infoBtn = document.getElementById('smartToolsInfoBtn');
            var infoBox = document.getElementById('smartToolsInfoBox');
            if (infoBtn && infoBox) {
                infoBtn.addEventListener('click', function() {
                    if (infoBox.style.display === 'none' || infoBox.style.display === '') {
                        infoBox.style.display = 'block';
                    } else {
                        infoBox.style.display = 'none';
                    }
                });
            }
        });
    </script>

<script>
    /**
     * Sistema padronizado de alertas para PrFastTool
     * Tipos dispon√≠veis: success, error, warning, info
     */
    
    // Inicializar o sistema de alertas
    function initAlertSystem() {
        // Fechar alerta ao clicar no X
        document.getElementById('closeAlert').addEventListener('click', function() {
            document.getElementById('prFastToolAlert').style.display = 'none';
        });
        
        // Fechar alerta ao clicar no bot√£o OK
        document.getElementById('alertOkBtn').addEventListener('click', function() {
            document.getElementById('prFastToolAlert').style.display = 'none';
        });
        
        // Fechar alerta ao pressionar ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('prFastToolAlert').style.display === 'block') {
                document.getElementById('prFastToolAlert').style.display = 'none';
            }
        });
    }
    
    // Mostrar alerta com tipo espec√≠fico
    function showAlert(type, title, message, toolIcon) {
        // Obter elementos
        const alertElement = document.getElementById('prFastToolAlert');
        const headerElement = alertElement.querySelector('.alert-header');
        const titleElement = document.getElementById('alertTitle');
        const messageElement = document.getElementById('alertMessage');
        const iconElement = document.getElementById('alertIcon');
        
        // Definir classe do header baseado no tipo
        headerElement.className = 'alert-header ' + type;
        
        // Definir t√≠tulo e mensagem
        titleElement.textContent = title;
        messageElement.innerHTML = message;
        
        // Definir √≠cone
        if (toolIcon) {
            iconElement.src = toolIcon;
        } else {
            // Usar √≠cones padr√£o baseados no tipo
            iconElement.src = `../assets/icon-${type}.png`;
        }
        
        // Exibir alerta
        alertElement.style.display = 'block';
        
        // Focar no bot√£o OK
        setTimeout(() => {
            document.getElementById('alertOkBtn').focus();
        }, 100);
    }
    
    // Fun√ß√µes espec√≠ficas para cada tipo de alerta
    function showSuccessAlert(title, message, toolIcon) {
        showAlert('success', title, message, toolIcon);
    }
    
    function showErrorAlert(title, message, toolIcon) {
        showAlert('error', title, message, toolIcon);
    }
    
    function showWarningAlert(title, message, toolIcon) {
        showAlert('warning', title, message, toolIcon);
    }
    
    function showInfoAlert(title, message, toolIcon) {
        showAlert('info', title, message, toolIcon);
    }
    
    // Inicializar o sistema de alertas quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', initAlertSystem);
</script>
    <script>
    // Fun√ß√£o para abrir a aba Smart Tools
    function openSmartToolsTab() {
        try {
            // Remover classe ativa de todos os bot√µes de aba
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Definir aba Smart Tools como ativa
            var smartToolsBtn = document.querySelector('.tab-button[data-tab="smarttools"]');
            if (smartToolsBtn) smartToolsBtn.classList.add('active');
            
            // Esconder todos os conte√∫dos de abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar conte√∫do da aba Smart Tools
            var smartToolsContent = document.getElementById('smarttools-tab');
            if (smartToolsContent) smartToolsContent.classList.add('active');
            
            log('‚úÖ Smart Tools tab ativada via console');
            return true;
        } catch (e) {
            log('‚ùå Erro ao ativar aba Smart Tools: ' + e.message, true);
            return false;
        }
    }
    </script>

</body>
</html>
